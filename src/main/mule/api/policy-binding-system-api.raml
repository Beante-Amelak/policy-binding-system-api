#%RAML 1.0
title: Lula Insurance - Policy Binding System API
version: v1
baseUri: https://api.lulainsurance.com/system/policies/{version}
mediaType: application/json
protocols: [ HTTPS ]

description: |
  System API responsible for binding insurance policies in the
  Policy Administration System (PAS). This API is called by
  MuleSoft Process APIs only.

# =========================================================
# Security Scheme: Client ID & Client Secret
# =========================================================
securitySchemes:
  client_id_enforcement:
    type: x-client-id-enforcement
    description: Client ID and Client Secret enforcement
    describedBy:
      headers:
        client_id:
          type: string
          required: true
          description: MuleSoft client ID
        client_secret:
          type: string
          required: true
          description: MuleSoft client secret
      responses:
        401:
          description: Unauthorized - Invalid client credentials
        403:
          description: Forbidden - Client not allowed

securedBy:
  - client_id_enforcement

# =========================================================
# Types
# =========================================================
types:

  PolicyBindingRequest:
    type: object
    properties:
      quoteId:
        type: string
        required: true
        description: Quote identifier generated earlier
      customer:
        type: object
        required: true
        properties:
          customerId:
            type: string
            required: true
          firstName?:
            type: string
          lastName?:
            type: string
          dateOfBirth?:
            type: date-only
      product:
        type: object
        required: true
        properties:
          productCode:
            type: string
            required: true
          coverageAmount?:
            type: number
            format: double
      premium:
        type: object
        required: true
        properties:
          amount:
            type: number
            required: true
            format: double
          currency:
            type: string
            required: true
      effectiveDate:
        type: date-only
        required: true

  PolicyBindingResponse:
    type: object
    properties:
      policyNumber:
        type: string
        description: Unique policy number generated by PAS
      policyId:
        type: string
      status:
        type: string
        enum: [ BOUND ]
      effectiveDate:
        type: date-only
      message:
        type: string

  ErrorResponse:
    type: object
    properties:
      errorCode:
        type: string
      errorMessage:
        type: string
      correlationId:
        type: string

# =========================================================
# Resources
# =========================================================
/policies:
  post:
    description: |
      Binds an insurance policy in the Policy Administration System.
      Generates a policy number and persists the policy.
    body:
      application/json:
        type: PolicyBindingRequest
        example:
          {
            "quoteId": "Q-123456",
            "customer": {
              "customerId": "C-78910",
              "firstName": "Jane",
              "lastName": "Doe",
              "dateOfBirth": "1985-06-15"
            },
            "product": {
              "productCode": "LULA-LIFE-STD",
              "coverageAmount": 250000
            },
            "premium": {
              "amount": 120.50,
              "currency": "USD"
            },
            "effectiveDate": "2026-02-01"
          }
    responses:
      201:
        description: Policy successfully bound
        body:
          application/json:
            type: PolicyBindingResponse
            example:
              {
                "policyNumber": "PL-45678901",
                "policyId": "POL-998877",
                "status": "BOUND",
                "effectiveDate": "2026-02-01",
                "message": "Policy successfully bound"
              }
      400:
        description: Invalid request data
        body:
          application/json:
            type: ErrorResponse
      401:
        description: Unauthorized
        body:
          application/json:
            type: ErrorResponse
      500:
        description: PAS system error
        body:
          application/json:
            type: ErrorResponse
